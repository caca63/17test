<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>17Live ä¸‰æ˜Ÿå½©ä¸­çæ©Ÿç‡è¨ˆç®—å™¨ v17.9</title>
<style>
body{background:#0f172a;color:#e5e7eb;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;margin:0;padding:16px}
.card{background:#111827cc;padding:14px;border-radius:16px;margin-bottom:12px}
.btn{padding:8px 12px;border-radius:8px;border:0;background:linear-gradient(135deg,#22d3ee,#60a5fa);color:#081018;font-weight:700;cursor:pointer}
.btn.sec{background:#0b1020;color:#e5e7eb;border:1px solid rgba(148,163,184,.25)}
input,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(148,163,184,.25);background:#0b1020;color:#e5e7eb}
.row{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-top:4px}
.divider{border-top:1px dashed rgba(148,163,184,.4);margin:2px 0}
.mono{white-space:pre-wrap;font-family:ui-monospace,Consolas,monospace}
label.switch{display:inline-block;font-size:13px;vertical-align:middle;margin:0;padding:0}
label.switch input{margin-right:4px;vertical-align:middle}
#strictWrap{display:inline-block;font-size:13px;margin:0;padding:0}
#strictWrap input{margin-right:3px;vertical-align:middle}
</style>
</head>
<body>
<h1>17Live ä¸‰æ˜Ÿå½©ä¸­çæ©Ÿç‡è¨ˆç®—å™¨</h1>
<div id="stats" style="color:#60a5fa;font-size:13px;line-height:1.4;margin-bottom:8px"></div>
<div style="color:#94a3b8;font-size:13px;margin-bottom:10px">
  å»ºè­°é è¨­ï¼šr=0.80ã€å•Ÿç”¨ã€ŒğŸ” ç†±è™Ÿé€£é–‹æ‡²ç½°ã€èˆ‡ã€Œé¿å…é‡è¤‡ä¸Šä¸€æœŸã€
</div>

<div class="card">
  <label>è¡°æ¸›æ¬Šé‡ r</label>
  <div class="row">
    <input id="r" type="number" step="0.01" value="0.8" min="0" max="1" style="max-width:100px">
    <button class="btn sec" onclick="setR(0.6)">r=0.6</button>
    <button class="btn sec" onclick="setR(0.8)">r=0.8</button>
    <button class="btn sec" onclick="setR(0.95)">r=0.95</button>
  </div>
  <div class="row" style="margin-top:8px">
    <label class="switch"><input type="checkbox" id="streak" checked> ğŸ” ç†±è™Ÿé€£é–‹æ‡²ç½°</label>
    <label class="switch"><input type="checkbox" id="avoidRepeat" checked onchange="toggleStrict()"> é¿å…é‡è¤‡ä¸Šä¸€æœŸ</label>
    <label id="strictWrap"><input type="checkbox" id="strictRepeat"> åš´æ ¼æ’é™¤ï¼ˆå…©ç¢¼ä»¥ä¸Šé‡è¤‡ç›´æ¥å‰ƒé™¤ï¼‰</label>
  </div>

  <label style="margin-top:8px">æˆ‘çš„ä¸‹æ³¨ï¼ˆä¸‰é¡†ä¸€çµ„ï¼Œæ¯è¡Œä¸€çµ„ï¼‰</label>
  <textarea id="bets" placeholder="ä¾‹å¦‚ï¼š1 4 6&#10;1 9 2&#10;4 6 9"></textarea>

  <div class="row" style="margin-top:8px">
    <button class="btn" onclick="run()">è¨ˆç®—ä¸­çæ©Ÿç‡</button>
  </div>

  <div class="divider" style="margin:10px 0"></div>
  <label>æ–°å¢æœ€æ–°ä¸€æœŸï¼ˆä¸‰é¡†ï¼‰</label>
  <input id="latest" placeholder="ä¾‹å¦‚ï¼š2 5 7">
  <div class="row">
    <button class="btn" onclick="appendLatest()">ï¼‹ åŠ å…¥åˆ°æ­·å²</button>
    <button class="btn sec" onclick="clearAdded()">é‡ç½®æœ¬æ©Ÿæ–°å¢</button>
  </div>
</div>

<div class="card">
  <h3>ğŸ”¢ å„è™Ÿç¢¼æ©Ÿç‡åˆ†ä½ˆï¼ˆä¾æ¬Šé‡æ©Ÿç‡æ’åºï¼‰</h3>
  <div style="font-size:12px;color:#9ca3af;margin-bottom:4px">
    å–®è™Ÿå¹³å‡ç†è«–æ©Ÿç‡ï¼šç´„ 10.00%ï¼ˆå®Œå…¨éš¨æ©Ÿ 1/10ï¼‰
  </div>
  <ul id="singleTop" class="mono" style="padding-left:0;margin:4px 0;list-style:none;font-size:13px;color:#9ca3af">
    <li>å°šæœªè¨ˆç®—ï¼Œè«‹å…ˆæŒ‰ã€Œè¨ˆç®—ä¸­çæ©Ÿç‡ã€ã€‚</li>
  </ul>
</div>

<div class="card">
  <h3>ğŸ’¡ æœ€æ–°æ¨è–¦çµæœï¼ˆTop1ï½Top10ï¼‰</h3>
  <div style="font-size:12px;color:#9ca3af;margin-bottom:4px">
    ä¸‰è™Ÿçµ„å¹³å‡ç†è«–æ©Ÿç‡ï¼šç´„ 0.83%ï¼ˆ1 / C(10,3) â‰ˆ 1/120ï¼‰
  </div>
  <ul id="toplist" class="mono" style="padding-left:0;margin:4px 0;list-style:none"></ul>
</div>

<div class="card">
  <h3>æˆ‘çš„ä¸‹æ³¨çµæœ</h3>
  <div id="myres" class="mono" style="font-size:13px;color:#94a3b8">å°šæœªè¨ˆç®—</div>
</div>

<div class="card">
  <h3>ğŸ“ˆ å‘½ä¸­ç´€éŒ„è¡¨ï¼ˆå›æ¸¬ï¼šä»¥ TopN é æ¸¬ä¸‹ä¸€æœŸï¼‰</h3>
  <div style="font-size:12px;color:#9ca3af;margin-bottom:6px">
    ğŸ”¢ å›æ¸¬æ¡ç”¨å‰
    <select id="topN" onchange="run()" style="background:#020617;color:#e5e7eb;border:1px solid rgba(148,163,184,.6);border-radius:6px;padding:2px 6px;font-size:12px">
      <option value="1">1</option>
      <option value="3" selected>3</option>
      <option value="5">5</option>
      <option value="10">10</option>
    </select>
    çµ„
  </div>
  <div id="hitSummary" style="font-size:12px;color:#9ca3af;margin-bottom:4px">
    å°šæœªå›æ¸¬ã€‚è«‹å…ˆæŒ‰ã€Œè¨ˆç®—ä¸­çæ©Ÿç‡ã€ï¼Œç³»çµ±æœƒä¾ç›®å‰è¨­å®šå›æ¸¬å…¨éƒ¨æ­·å²ï¼Œä¸¦é¡¯ç¤ºæœ€è¿‘ 10 æœŸçµ±è¨ˆã€‚
  </div>
  <div id="hitTable" class="mono" style="font-size:12px;color:#cbd5f5;max-height:260px;overflow:auto;border-top:1px solid rgba(148,163,184,.4);padding-top:4px"></div>
</div>

<script>
// å…§å»º 20 æœŸæ­·å²ï¼ˆæœ€å¾Œå¹¾æœŸï¼š2 4 7ã€1 4 6ã€4 6 10ï¼‰
const baseHistory=[
  [7,5,6],[9,10,4],[9,8,1],[5,4,1],[6,9,1],
  [3,7,10],[10,2,3],[8,9,6],[1,5,9],[4,1,8],
  [6,4,2],[10,8,6],[6,4,8],[4,9,10],[10,5,3],
  [9,6,1],[6,5,10],[2,4,7],[1,4,6],[4,6,10]
];
const LS_KEY="extraHist_v179";
let added=JSON.parse(localStorage.getItem(LS_KEY)||"[]");

function toggleStrict(){
  document.getElementById("strictWrap").style.display=
    document.getElementById("avoidRepeat").checked?"inline-block":"none";
}
toggleStrict();

function updateStats(){
  const total=baseHistory.length+added.length;
  const latest=(added.length?added[added.length-1]:baseHistory[baseHistory.length-1]).join(" ");
  document.getElementById("stats").innerHTML=
    `ğŸ“Š ç›®å‰å…±æœ‰ ${total} æœŸï¼ˆå« ${added.length} æœŸæœ¬æ©Ÿæ–°å¢ï¼‰<br>æœ€æ–°ä¸€æœŸï¼š${latest}`;
}
updateStats();

function appendLatest(){
  const v=document.getElementById("latest").value.trim().split(/\s+/).map(Number);
  if(v.length===3&&v.every(n=>!isNaN(n))){
    added.push(v);
    localStorage.setItem(LS_KEY,JSON.stringify(added));
    updateStats();
    alert("å·²åŠ å…¥ï¼");
    document.getElementById("latest").value="";
  }else alert("è«‹è¼¸å…¥ä¸‰å€‹æ•¸å­—");
}
function clearAdded(){
  if(confirm("ç¢ºå®šæ¸…é™¤ï¼Ÿ")){
    added=[];
    localStorage.removeItem(LS_KEY);
    updateStats();
  }
}
function setR(v){document.getElementById("r").value=v;}
function getAll(){return baseHistory.concat(added);}

// å–®è™Ÿæ¬Šé‡ï¼ˆå« r + ç†±è™Ÿé€£é–‹æ‡²ç½°ï¼‰
function singleProbsByR(hist,r,sp){
  const w=Array(10).fill(0),n=hist.length;
  for(let i=0;i<n;i++){
    const ww=Math.pow(r,n-1-i);
    for(const x of hist[i])w[x-1]+=ww;
  }
  if(sp){
    for(let num=1;num<=10;num++){
      let c=0,m=0,maxc=0,maxm=0;
      for(let i=0;i<n;i++){
        if(hist[i].includes(num)){c++;maxc=Math.max(maxc,c);m=0;}
        else{m++;maxm=Math.max(maxm,m);c=0;}
      }
      if(maxc>=3)w[num-1]*=0.7;
      if(maxm>=3)w[num-1]*=1.2;
    }
  }
  const s=w.reduce((a,b)=>a+b,0)||1;
  return w.map(v=>v/s);
}

function allTrios(){
  const r=[];
  for(let i=1;i<=10;i++)
    for(let j=i+1;j<=10;j++)
      for(let k=j+1;k<=10;k++)
        r.push([i,j,k]);
  return r;
}

function trioProb(p,t){
  const[a,b,c]=t.map(x=>p[x-1]);
  const seq=(x,y,z)=>(x*(y/(1-x))*(z/(1-x-y)));
  return[
    seq(a,b,c),seq(a,c,b),
    seq(b,a,c),seq(b,c,a),
    seq(c,a,b),seq(c,b,a)
  ].reduce((x,y)=>x+y,0);
}
function fmt(x){return(x*100).toFixed(2)+"%";}

// å–®è™Ÿåˆ†ä½ˆï¼ˆå«ä¸Šä¸€æœŸæ‡²ç½°ï¼‰
function updateSingleTop(probs,hist){
  const n=hist.length;
  const last=hist[n-1]||[];
  const prev=hist[n-2]||[];
  const prev2=hist[n-3]||[];
  const weights=[];
  for(let i=0;i<10;i++){
    const num=i+1;
    let f=1;
    // ä¸Šä¸€æœŸé–‹é â†’ Ã—0.6
    if(last.includes(num))f*=0.6;
    // é€£å…©æœŸé–‹é â†’ å† Ã—0.7
    if(prev.includes(num))f*=0.7;
    // é€£ä¸‰æœŸéƒ½é–‹é â†’ å† Ã—0.85
    if(prev2.includes(num)&&prev.includes(num)&&last.includes(num))f*=0.85;
    weights.push(probs[i]*f);
  }
  const sum=weights.reduce((a,b)=>a+b,0)||1;
  const adj=weights.map(w=>w/sum);
  const arr=adj.map((p,i)=>({num:i+1,p})).sort((a,b)=>b.p-a.p);
  let html="";
  for(const o of arr){
    let c="#9ca3af";
    if(o.p>0.03)c="#38bdf8";
    else if(o.p>=0.02)c="#e5e7eb";
    html+=`<li><span style="color:${c}">è™Ÿç¢¼ ${o.num} â†’ ${(o.p*100).toFixed(2)}%</span></li>`;
  }
  document.getElementById("singleTop").innerHTML=html;
}

// çµ„åˆå±¤è¨ˆç®—ï¼šå¥—ç”¨ ç†±è™Ÿæ‡²ç½° + é¿å…é‡è¤‡ä¸Šä¸€æœŸï¼ˆå¹³è¡¡ç‰ˆï¼‰
function computeTopCombos(hist,probs,avoid,strict){
  const tri=allTrios();
  const n=hist.length;
  const last=hist[n-1];
  const prev=hist[n-2]||[];
  const hotSet=new Set([...last,...prev]); // ç†±è™Ÿï¼æœ€è¿‘å…©æœŸå‡ºç¾é

  const scored=[];
  for(const t of tri){
    let sc=trioProb(probs,t);
    if(sc<=0)continue;

    // â‘  ç†±è™Ÿçµ„åˆæ‡²ç½°ï¼ˆå¹³è¡¡ä¿‚æ•¸ï¼‰
    const hotCount=t.filter(x=>hotSet.has(x)).length;
    if(hotCount===1)sc*=0.9;
    else if(hotCount===2)sc*=0.75;
    else if(hotCount===3)sc*=0.6;

    // â‘¡ é¿å…é‡è¤‡ä¸Šä¸€æœŸè™Ÿç¢¼ï¼ˆéåš´æ ¼ä¹Ÿåªæ˜¯é™æ¬Šï¼‰
    if(avoid){
      const sameLast=t.filter(x=>last.includes(x)).length;
      if(strict && sameLast>=2){
        sc=0;
      }else if(!strict){
        if(sameLast===1)sc*=0.85;
        else if(sameLast===2)sc*=0.7;
        else if(sameLast===3)sc*=0.5;
      }
    }

    if(sc>0)scored.push({t,sc});
  }
  scored.sort((a,b)=>b.sc-a.sc);
  return scored;
}

// å›æ¸¬ï¼šç”¨æ¯æœŸ TopN é æ¸¬ä¸‹ä¸€æœŸ
function backtestTopN(hist,r,sp,avoid,strict,topN){
  const n=hist.length;
  const rows=[];
  if(n<2)return rows;

  for(let i=0;i<n-1;i++){
    const train=hist.slice(0,i+1);
    const target=hist[i+1];
    const probs=singleProbsByR(train,r,sp);
    const scored=computeTopCombos(train,probs,avoid,strict);
    const top=scored.slice(0,topN);

    let bestHit=0;
    const hitCombos=[];
    for(const item of top){
      const hitCount=item.t.filter(x=>target.includes(x)).length;
      if(hitCount>0)hitCombos.push({t:item.t,hit:hitCount});
      if(hitCount>bestHit)bestHit=hitCount;
    }

    rows.push({
      issue:i+2,
      target,
      bestHit,
      hitCombos,
      topN
    });
  }
  return rows;
}

// å‘½ä¸­ç´€éŒ„è¡¨é¡¯ç¤º
function renderHits(rows,topN){
  const summaryDiv=document.getElementById("hitSummary");
  const tableDiv=document.getElementById("hitTable");
  if(!rows.length){
    summaryDiv.textContent="æ­·å²æœŸæ•¸ä¸è¶³ï¼Œç„¡æ³•å›æ¸¬ã€‚";
    tableDiv.textContent="";
    return;
  }

  const recent=rows.slice(-10);
  const total=recent.length;
  let c3=0,c2=0,c1=0,c0=0,any=0;
  for(const r of recent){
    if(r.bestHit>=1)any++;
    if(r.bestHit===3)c3++;
    else if(r.bestHit===2)c2++;
    else if(r.bestHit===1)c1++;
    else c0++;
  }
  summaryDiv.textContent=
    `æœ€è¿‘ ${total} æœŸï¼ˆTop${topN} å›æ¸¬ï¼‰ï¼šè‡³å°‘ä¸­ 1 é¡†çš„æœŸæ•¸ ${any} æœŸï¼Œå…¨ä¸­ 3 é¡†ï¼š${c3} æœŸï¼Œä¸­ 2 é¡†ï¼š${c2} æœŸï¼Œä¸­ 1 é¡†ï¼š${c1} æœŸï¼Œå®Œå…¨æœªä¸­ï¼š${c0} æœŸã€‚`;

  let html="";
  for(const r of recent){
    const issue=`ç¬¬ ${r.issue} æœŸ`;
    const targetStr=r.target.join(" ");
    const hitLabel=(r.bestHit>0)?`${r.bestHit} é¡†`:"0 é¡†";
    let comboStr="â€”";
    if(r.hitCombos.length){
      const best=r.bestHit;
      const bestList=r.hitCombos.filter(x=>x.hit===best);
      comboStr=bestList.map(x=>x.t.join(" ")).join("ã€");
    }
    html+=`${issue}ï½œé–‹çï¼š${targetStr}ï½œæœ€ä½³å‘½ä¸­ï¼š${hitLabel}ï½œå‘½ä¸­çµ„åˆï¼š${comboStr}\n`;
  }
  tableDiv.textContent=html.trim();
}

function run(){
  const hist=getAll();
  let r=parseFloat(document.getElementById("r").value);
  if(isNaN(r)||r<=0||r>=1){
    r=0.8;
    document.getElementById("r").value="0.80";
  }
  const sp=document.getElementById("streak").checked;
  const avoid=document.getElementById("avoidRepeat").checked;
  const strict=document.getElementById("strictRepeat").checked;
  const topN=parseInt(document.getElementById("topN").value,10)||3;

  const probs=singleProbsByR(hist,r,sp);
  updateSingleTop(probs,hist);

  const scored=computeTopCombos(hist,probs,avoid,strict);
  const top=scored.slice(0,10);
  document.getElementById("toplist").innerHTML=
    top.map((o,i)=>`<li>${i+1}. ${o.t.join(" ")} â†’ ${fmt(o.sc)}</li>`).join("<div class='divider'></div>");

  const bets=document.getElementById("bets").value.trim();
  if(!bets){
    document.getElementById("myres").textContent="å°šæœªè¼¸å…¥ä¸‹æ³¨ã€‚";
  }else{
    const lines=bets.split(/\n+/).map(l=>l.trim()).filter(Boolean);
    const res=[];
    for(const l of lines){
      const trio=l.split(/\s+/).map(Number).filter(n=>!isNaN(n));
      if(trio.length!==3){res.push(`${l} â†’ æ ¼å¼éŒ¯èª¤`);continue;}
      const pz=trioProb(probs,trio);
      res.push(`${trio.join(" ")} â†’ ${fmt(pz)}`);
    }
    document.getElementById("myres").textContent=res.join("\n");
  }

  const rows=backtestTopN(hist,r,sp,avoid,strict,topN);
  renderHits(rows,topN);
}
</script>
</body>
</html>
