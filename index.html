<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>539 三號組中獎機率計算器｜手機版</title>
<style>
  :root{
    --bg:#0f172a;
    --card:#111827;
    --muted:#94a3b8;
    --text:#e5e7eb;
    --accent:#22d3ee;
    --accent2:#60a5fa;
    --good:#34d399;
    --warn:#fbbf24;
    --bad:#f87171;
  }
  *{box-sizing:border-box}
  body{
    margin:0;padding:16px;
    font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji";
    background:linear-gradient(180deg,#0b1220, #0f172a 60%);
    color:var(--text);
  }
  h1{font-size:22px;margin:0 0 12px;letter-spacing:.5px}
  .sub{color:var(--muted);font-size:14px;margin-bottom:16px}
  .grid{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:768px){ .grid{grid-template-columns:1fr 1fr} }
  .card{
    background:rgba(17,24,39,.7);
    border:1px solid rgba(148,163,184,.15);
    border-radius:16px;
    padding:14px;
    box-shadow:0 10px 30px rgba(0,0,0,.25);
    backdrop-filter: blur(6px);
  }
  label{display:block;margin:8px 0 6px;font-weight:600}
  input[type="text"], textarea, input[type="number"]{
    width:100%; padding:12px 12px; border-radius:12px; border:1px solid rgba(148,163,184,.25);
    background:#0b1020; color:var(--text); font-size:16px; outline:none;
  }
  textarea{min-height:110px;resize:vertical}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .btn{
    appearance:none; border:0; border-radius:12px; padding:12px 14px; font-weight:700;
    color:#081018; background:linear-gradient(135deg,var(--accent),var(--accent2));
    box-shadow:0 8px 20px rgba(34,211,238,.25);
  }
  .btn.sec{ background:#0b1020; color:var(--text); border:1px solid rgba(148,163,184,.25) }
  .btn.small{ padding:9px 10px; font-size:14px }
  .chips{display:flex; gap:8px; flex-wrap:wrap}
  .chip{padding:8px 10px; border-radius:999px; border:1px solid rgba(148,163,184,.25); color:var(--muted); font-size:13px}
  .switch{display:flex; align-items:center; gap:10px}
  .switch input{transform:scale(1.2)}
  .mono{font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; font-size:14px; white-space:pre-wrap}
  .pill{display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; font-weight:700}
  .pill.good{background:rgba(52,211,153,.15); color:var(--good)}
  .pill.warn{background:rgba(251,191,36,.15); color:var(--warn)}
  .pill.bad{background:rgba(248,113,113,.15); color:var(--bad)}
  .list li{margin:6px 0}
  .muted{color:var(--muted)}
  .kpi{display:flex; gap:10px; flex-wrap:wrap}
  .kpi .box{flex:1 1 120px; background:#0b1020; border:1px solid rgba(148,163,184,.2); border-radius:12px; padding:10px}
  .box h3{margin:0 0 6px; font-size:13px; color:var(--muted); font-weight:600}
  .box .v{font-size:18px; font-weight:800}
  .footer{margin-top:14px; font-size:12px; color:var(--muted)}
</style>
</head>
<body>
  <h1>539 三號組中獎機率計算器</h1>
  <div class="sub">UI = B（手機優化）、邏輯 = C（平均 / R 值 / 熱冷混合 交叉）｜順序不重要</div>

  <div class="grid">
    <div class="card">
      <label>新增最新一期（三顆，以空格分隔，可不填）</label>
      <input id="latest" type="text" placeholder="例如：2 5 7" inputmode="numeric" />
      <div class="row" style="margin-top:8px">
        <div class="switch">
          <input id="streak" type="checkbox" />
          <label for="streak" style="margin:0">啟用 streak penalty</label>
        </div>
      </div>

      <label style="margin-top:10px">衰減權重 r</label>
      <div class="row">
        <input id="r" type="number" step="0.01" min="0" max="1" value="0.80" style="max-width:120px" />
        <button class="btn small sec" onclick="setR(0.6)">r=0.60</button>
        <button class="btn small sec" onclick="setR(0.8)">r=0.80</button>
        <button class="btn small sec" onclick="setR(0.95)">r=0.95</button>
      </div>

      <label style="margin-top:10px">我的下注（每行一組，空格分隔）</label>
      <textarea id="bets" placeholder="例：&#10;1 4 6&#10;1 9 2&#10;4 6 9">1 4 6
1 9 2
4 6 9</textarea>

      <div class="row" style="margin-top:10px">
        <button class="btn" onclick="run()">計算中獎機率 & 生成推薦</button>
        <button class="btn sec" onclick="clearLatest()">清空最新一期</button>
      </div>
      <div class="footer">小提示：r 越接近 1 → 越重視最近；streak penalty 會抑制連續爆發號、略加權長時間未開號。</div>
    </div>

    <div class="card">
      <div class="kpi">
        <div class="box">
          <h3>內建歷史期數</h3>
          <div class="v" id="k_hist">11</div>
        </div>
        <div class="box">
          <h3>當前 r</h3>
          <div class="v" id="k_r">0.80</div>
        </div>
        <div class="box">
          <h3>平均基線 (任一組)</h3>
          <div class="v">0.833%</div>
        </div>
      </div>

      <label style="margin-top:10px">我的下注結果</label>
      <div id="myres" class="mono muted">尚未計算</div>

      <label style="margin-top:10px">交叉推薦（邏輯 C）</label>
      <ul id="ensemble" class="list mono"></ul>
    </div>
  </div>

  <div class="card" style="margin-top:12px">
    <h3 style="margin:0 0 6px">方法 A：平均型（等權）</h3>
    <div class="mono muted">所有三號組機率皆為 1/120 ≈ 0.833%（不依賴歷史，僅作基線比較）。</div>
  </div>

  <div class="grid" style="margin-top:12px">
    <div class="card">
      <h3 style="margin:0 0 6px">方法 B：R 值模型（依 r、可選 streak penalty）</h3>
      <div class="mono" id="rmodel_nums"></div>
      <div style="height:8px"></div>
      <div class="mono" id="rmodel_top"></div>
    </div>
    <div class="card">
      <h3 style="margin:0 0 6px">方法 C：熱 2 + 冷 1（依目前資料）</h3>
      <div class="mono" id="hotcold"></div>
    </div>
  </div>

<script>
// 內建 11 期
const baseHistory = [
  [7,5,6],
  [9,10,4],
  [9,8,1],
  [5,4,1],
  [6,9,1],
  [3,7,10],
  [10,2,3],
  [8,9,6],
  [1,5,9],
  [4,1,8],
  [6,4,2]
];

function setR(v){
  document.getElementById('r').value = v.toFixed(2);
  document.getElementById('k_r').textContent = v.toFixed(2);
}

function clearLatest(){
  document.getElementById('latest').value = '';
}

function getHistory(){
  const latest = document.getElementById('latest').value.trim();
  const hist = baseHistory.map(row=>row.slice());
  if(latest){
    const parts = latest.split(/\s+/).map(x=>parseInt(x,10)).filter(Boolean);
    if(parts.length===3){ hist.push(parts); }
  }
  document.getElementById('k_hist').textContent = String(hist.length);
  return hist;
}

// 計權重與單號機率
function singleProbsByR(hist, r, useStreak){
  const weights = Array(10).fill(0);
  for(let i=0;i<hist.length;i++){
    const w = Math.pow(r, hist.length-1-i);
    for(const n of hist[i]) weights[n-1]+=w;
  }
  if(useStreak){
    for(let n=1;n<=10;n++){
      let consec=0, miss=0, maxConsec=0, maxMiss=0;
      for(let i=0;i<hist.length;i++){
        if(hist[i].includes(n)){ consec++; maxConsec=Math.max(maxConsec, consec); miss=0; }
        else { miss++; maxMiss=Math.max(maxMiss, miss); consec=0; }
      }
      if(maxConsec>=3) weights[n-1]*=0.7;
      if(maxMiss>=3)  weights[n-1]*=1.2;
    }
  }
  const sum = weights.reduce((a,b)=>a+b,0);
  return weights.map(w=> w/sum); // 機率加總=1
}

// 三號組中獎機率（順序無關，三顆全中即可）
function trioProb(probs, trio){
  const [a,b,c] = trio.map(n=>probs[n-1]);
  if(a<=0 || b<=0 || c<=0 || a>=1 || b>=1 || c>=1) return 0;
  function seq(x,y,z){ return (x) * (y/(1-x)) * (z/(1-x-y)); }
  const terms = [
    seq(a,b,c), seq(a,c,b),
    seq(b,a,c), seq(b,c,a),
    seq(c,a,b), seq(c,b,a)
  ];
  return terms.reduce((s,t)=>s+(isFinite(t)?t:0),0);
}

function allTrios(){
  const res=[];
  for(let i=1;i<=10;i++){
    for(let j=i+1;j<=10;j++){
      for(let k=j+1;k<=10;k++){
        res.push([i,j,k]);
      }
    }
  }
  return res;
}

function simpleCounts(hist){
  const c = Array(10).fill(0);
  for(const row of hist) for(const n of row) c[n-1]++;
  return c;
}

function fmtPct(x){ return (x*100).toFixed(2)+'%'; }

function run(){
  const r = Math.max(0, Math.min(1, parseFloat(document.getElementById('r').value) || 0.8));
  document.getElementById('k_r').textContent = r.toFixed(2);
  const useStreak = document.getElementById('streak').checked;
  const hist = getHistory();

  // 方法 B：R 值模型（以目前 r）
  const probsR = singleProbsByR(hist, r, useStreak);
  const trios = allTrios();
  trios.sort((A,B)=> trioProb(probsR,B) - trioProb(probsR,A));
  const topR = trios.slice(0,10).map(T => `${T.join(' ')}  →  ${fmtPct(trioProb(probsR,T))}`).join('\n');
  const topSingles = probsR.map((p,i)=>({n:i+1,p})).sort((a,b)=>b.p-a.p).slice(0,5);
  const numsTxt = '前5單號（依 r 加權'+(useStreak?'+streak':'' )+'）\n' + topSingles.map(o=>`${o.n} : ${fmtPct(o.p)}`).join('\n');
  document.getElementById('rmodel_nums').textContent = numsTxt;
  document.getElementById('rmodel_top').textContent = '前10三號組（方法B）\n' + topR;

  // 方法 C：熱2 + 冷1（簡單頻率挑號，機率用當前 r 計）
  const cnt = simpleCounts(hist);
  const orderIdx = [...cnt.keys()].sort((i,j)=> cnt[j]-cnt[i]);
  const hot = [orderIdx[0]+1, orderIdx[1]+1];
  const coldCandidates = [...cnt.keys()].sort((i,j)=> cnt[i]-cnt[j]);
  const cold = coldCandidates[0]+1;
  const trioC = [hot[0], hot[1], cold].sort((a,b)=>a-b);
  const probC = trioProb(probsR, trioC);
  document.getElementById('hotcold').textContent = `熱號2：${hot.join('、')}  +  冷號1：${cold}\n推薦組：${trioC.join(' ')}  →  ${fmtPct(probC)}（以 r 加權機率評估）`;

  // 我的下注
  const bets = document.getElementById('bets').value.trim().split(/\n+/).map(l=>l.trim()).filter(Boolean);
  const lines = [];
  for(const line of bets){
    const trio = line.split(/\s+/).map(x=>parseInt(x,10)).filter(Boolean).slice(0,3).sort((a,b)=>a-b);
    if(trio.length===3){
      const p = trioProb(probsR, trio);
      lines.push(`${trio.join(' ')}  →  ${fmtPct(p)}  ${p>=0.02? '▸ '+(p>=0.03? '★高':'良'):''}`);
    }
  }
  document.getElementById('myres').textContent = lines.length? lines.join('\n') : '（沒有輸入下注）';

  // 交叉推薦（C）：綜合
  const ens = [];
  const topB1 = trios[0], topB2 = trios.find(T => T.join(',')!==topB1.join(',')) || trios[1];
  ens.push(`B-1（r 模型）：${topB1.join(' ')}  →  ${fmtPct(trioProb(probsR, topB1))}`);
  ens.push(`B-2（r 模型）：${topB2.join(' ')}  →  ${fmtPct(trioProb(probsR, topB2))}`);
  ens.push(`C（熱2+冷1）：${trioC.join(' ')}  →  ${fmtPct(probC)}`);
  ens.push(`A（平均基線）：任一組皆 0.833%`);
  document.getElementById('ensemble').innerHTML = '<li>'+ens.join('</li><li>')+'</li>';
}
</script>
</body>
</html>
