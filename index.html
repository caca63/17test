<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>17Live ä¸‰æ˜Ÿå½©ä¸­çæ©Ÿç‡è¨ˆç®—å™¨ï½œæ­£å¼ç‰ˆ</title>
<style>
  :root{
    --bg:#0f172a;
    --card:#111827;
    --muted:#94a3b8;
    --text:#e5e7eb;
    --accent:#22d3ee;
    --accent2:#60a5fa;
  }
  *{box-sizing:border-box;}
  body{
    margin:0;
    padding:16px;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;
    background:linear-gradient(180deg,#0b1220,#0f172a 60%);
    color:var(--text);
  }
  h1{font-size:22px;margin:0 0 4px}
  .sub{color:var(--muted);font-size:13px;margin-bottom:8px}
  .stats{font-size:13px;color:var(--accent2);margin-bottom:10px;line-height:1.4}
  .card{
    background:#111827cc;
    padding:14px;
    border-radius:16px;
    margin-bottom:12px;
    border:1px solid rgba(148,163,184,.25);
  }
  label{font-size:14px;font-weight:600;display:block;margin:6px 0 4px}
  input[type="text"],input[type="number"],textarea{
    width:100%;
    padding:10px;
    border-radius:8px;
    border:1px solid rgba(148,163,184,.25);
    background:#0b1020;
    color:var(--text);
    font-size:14px;
  }
  textarea{min-height:90px;resize:vertical}
  .row{display:flex;flex-wrap:wrap;gap:8px;margin-top:4px;align-items:center}
  .btn{
    padding:8px 12px;
    border-radius:8px;
    border:0;
    background:linear-gradient(135deg,var(--accent),var(--accent2));
    color:#081018;
    font-weight:700;
    cursor:pointer;
    font-size:13px;
  }
  .btn.sec{
    background:#0b1020;
    color:var(--text);
    border:1px solid rgba(148,163,184,.25);
  }
  .list{padding-left:0;margin:4px 0}
  .list li{margin:2px 0;list-style:none}
  .divider{
    border-top:1px dashed rgba(148,163,184,.4);
    margin:1px 0;
  }
  .mono{white-space:pre-wrap;font-family:ui-monospace,Consolas,monospace}
  .note{font-size:12px;color:var(--muted);margin-top:4px}
</style>
</head>
<body>
<h1>17Live ä¸‰æ˜Ÿå½©ä¸­çæ©Ÿç‡è¨ˆç®—å™¨</h1>
<div class="stats" id="stats">ğŸ“Š ç›®å‰å…±æœ‰ 17 æœŸï¼ˆå« 0 æœŸæœ¬æ©Ÿæ–°å¢ï¼‰<br>æœ€æ–°ä¸€æœŸï¼š6 5 10</div>
<div class="sub">å»ºè­°é è¨­ï¼šr = 0.80ã€SP é–‹å•Ÿï¼ˆå…¼é¡§ç¬¬13æœŸå‘½ä¸­èˆ‡æ•´é«”ç©©å®šï¼‰</div>

<div class="card">
  <h3 style="margin:0 0 6px">è¨­å®š & è¨ˆç®—</h3>

  <label>è¡°æ¸›æ¬Šé‡ r</label>
  <div class="row">
    <input id="r" type="number" step="0.01" min="0" max="1" value="0.80" style="max-width:110px">
    <button class="btn sec" type="button" onclick="setR(0.6)">r=0.60</button>
    <button class="btn sec" type="button" onclick="setR(0.8)">r=0.80</button>
    <button class="btn sec" type="button" onclick="setR(0.95)">r=0.95</button>
  </div>

  <div class="row" style="margin-top:6px">
    <label style="font-weight:500;font-size:13px;">
      <input type="checkbox" id="streak" checked> å•Ÿç”¨ streak penalty
    </label>
  </div>

  <label style="margin-top:8px">æˆ‘çš„ä¸‹æ³¨ï¼ˆä¸‰é¡†ä¸€çµ„ï¼Œæ¯è¡Œä¸€çµ„ï¼‰</label>
  <textarea id="bets" placeholder="ä¾‹å¦‚ï¼š&#10;1 4 6&#10;1 9 2&#10;4 6 9"></textarea>

  <div class="row" style="margin-top:8px">
    <button class="btn" type="button" onclick="run()">è¨ˆç®—ä¸­çæ©Ÿç‡</button>
  </div>

  <div class="divider" style="margin:10px 0"></div>

  <label>æ–°å¢æœ€æ–°ä¸€æœŸï¼ˆä¸‰é¡†ï¼Œä»¥ç©ºæ ¼åˆ†éš”ï¼ŒåŠ å…¥æ­·å²ï¼‰</label>
  <input id="latest" type="text" placeholder="ä¾‹å¦‚ï¼š2 5 7" inputmode="numeric">
  <div class="row">
    <button class="btn" type="button" onclick="appendLatest()">ï¼‹ åŠ å…¥åˆ°æ­·å²ï¼ˆæœ¬æ©Ÿï¼‰</button>
    <button class="btn sec" type="button" onclick="clearAdded()">é‡ç½®æœ¬æ©Ÿæ–°å¢</button>
  </div>
  <div class="note">æœ¬æ©Ÿæ–°å¢æœƒå„²å­˜åœ¨ç€è¦½å™¨ï¼ˆlocalStorageï¼‰ï¼Œä¸å½±éŸ¿å…§å»º 17 æœŸã€‚</div>
</div>

<div class="card">
  <h3 style="margin:0 0 4px">ğŸ’¡ æœ€æ–°æ¨è–¦çµæœï¼ˆTop1ï½Top10ï¼‰</h3>
  <div class="note">ä¾ç•¶å‰ r & SP è¨­å®šè¨ˆç®—ï¼Œé †åºä¸åˆ†å…ˆå¾Œï¼Œä¸‰é¡†å…¨ä¸­å³ç‚ºä¸­çã€‚</div>
  <ul id="toplist" class="list mono">
    <li>ï¼ˆå°šæœªè¨ˆç®—ï¼‰</li>
  </ul>
</div>

<div class="card">
  <h3 style="margin:0 0 4px">æˆ‘çš„ä¸‹æ³¨çµæœ</h3>
  <div id="myres" class="mono note">å°šæœªè¨ˆç®—</div>
  <div class="note">åŸºç·šï¼šåœ¨å®Œå…¨å¹³å‡æƒ…æ³ä¸‹ï¼Œä»»ä¸€çµ„ä¸­çæ©Ÿç‡çš†ç´„ 1/120 â‰ˆ 0.833%ã€‚</div>
</div>

<script>
// å…§å»º 17 æœŸæ­·å²
const baseHistory = [
  [7,5,6],
  [9,10,4],
  [9,8,1],
  [5,4,1],
  [6,9,1],
  [3,7,10],
  [10,2,3],
  [8,9,6],
  [1,5,9],
  [4,1,8],
  [6,4,2],
  [10,8,6],
  [6,4,8],
  [4,9,10],
  [10,5,3],
  [9,6,1],
  [6,5,10]
];

const LS_KEY = "extraHistory_539_v1";

function loadAdded(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(!raw) return [];
    const arr = JSON.parse(raw);
    if(Array.isArray(arr)) return arr.filter(x => Array.isArray(x) && x.length===3);
    return [];
  }catch(e){
    return [];
  }
}

let addedHistory = loadAdded();

function saveAdded(){
  localStorage.setItem(LS_KEY, JSON.stringify(addedHistory));
}

function getFullHistory(){
  return baseHistory.concat(addedHistory);
}

function updateStats(){
  const hist = getFullHistory();
  const total = hist.length;
  const extra = addedHistory.length;
  const last = hist[hist.length-1] || [];
  const lastStr = last.length===3 ? last.join(" ") : "-";
  document.getElementById("stats").innerHTML =
    `ğŸ“Š ç›®å‰å…±æœ‰ ${total} æœŸï¼ˆå« ${extra} æœŸæœ¬æ©Ÿæ–°å¢ï¼‰<br>æœ€æ–°ä¸€æœŸï¼š${lastStr}`;
}

function appendLatest(){
  const txt = document.getElementById("latest").value.trim();
  if(!txt){
    alert("è«‹å…ˆè¼¸å…¥æœ€æ–°ä¸€æœŸä¸‰å€‹æ•¸å­—ã€‚");
    return;
  }
  const parts = txt.split(/\s+/).map(x=>parseInt(x,10)).filter(n=>!isNaN(n));
  if(parts.length!==3){
    alert("æ ¼å¼éŒ¯èª¤ï¼šè«‹è¼¸å…¥ä¸‰å€‹ 1~10 çš„æ•¸å­—ï¼Œä»¥ç©ºæ ¼åˆ†éš”ã€‚");
    return;
  }
  addedHistory.push(parts);
  saveAdded();
  document.getElementById("latest").value = "";
  updateStats();
  alert("å·²åŠ å…¥æœ¬æ©Ÿæ­·å²ï¼");
}

function clearAdded(){
  if(!confirm("ç¢ºå®šè¦æ¸…é™¤æœ¬æ©Ÿæ–°å¢çš„æ‰€æœ‰æœŸæ•¸å—ï¼Ÿ")) return;
  addedHistory = [];
  saveAdded();
  updateStats();
}

// è¨­å®š r å¿«æ·
function setR(v){
  document.getElementById("r").value = v.toFixed(2);
}

// è¨ˆç®—å–®è™Ÿæ©Ÿç‡ï¼ˆR æ¨¡å‹ + å¯é¸ streak penaltyï¼‰
function singleProbsByR(hist, r, useStreak){
  const weights = Array(10).fill(0);
  const n = hist.length;
  for(let i=0;i<n;i++){
    const w = Math.pow(r, n-1-i); // è¶Šæ–°çš„æ¬Šé‡è¶Šå¤§
    for(const num of hist[i]){
      weights[num-1] += w;
    }
  }

  if(useStreak){
    // å°æ¯å€‹è™Ÿç¢¼åš streak penalty / miss bonus
    for(let num=1; num<=10; num++){
      let consec = 0, miss = 0, maxConsec = 0, maxMiss = 0;
      for(let i=0;i<n;i++){
        if(hist[i].includes(num)){
          consec++;
          maxConsec = Math.max(maxConsec, consec);
          miss = 0;
        }else{
          miss++;
          maxMiss = Math.max(maxMiss, miss);
          consec = 0;
        }
      }
      if(maxConsec>=3) weights[num-1] *= 0.7; // é€£é–‹å¤ªå…‡ç¨å¾®å£“ä½
      if(maxMiss>=3)  weights[num-1] *= 1.2; // ä¹…æœªé–‹ç¨å¾®åŠ æ¬Š
    }
  }

  const sum = weights.reduce((a,b)=>a+b,0) || 1;
  return weights.map(w => w/sum); // æ©Ÿç‡ç¸½å’Œ = 1
}

// ç®—æŸä¸€çµ„ä¸‰è™Ÿçµ„çš„ä¸­çæ©Ÿç‡ï¼ˆé †åºä¸é‡è¦ï¼‰
function trioProb(probs, trio){
  const [a,b,c] = trio.map(n=>probs[n-1]);
  if(a<=0 || b<=0 || c<=0) return 0;
  if(a>=1 || b>=1 || c>=1) return 0;

  function seq(x,y,z){
    const denom1 = 1-x;
    const denom2 = 1-x-y;
    if(denom1<=0 || denom2<=0) return 0;
    return x * (y/denom1) * (z/denom2);
  }

  const perms = [
    [a,b,c],[a,c,b],
    [b,a,c],[b,c,a],
    [c,a,b],[c,b,a]
  ];
  let s = 0;
  for(const [x,y,z] of perms){
    s += seq(x,y,z);
  }
  return isFinite(s)? s : 0;
}

function allTrios(){
  const res = [];
  for(let i=1;i<=10;i++){
    for(let j=i+1;j<=10;j++){
      for(let k=j+1;k<=10;k++){
        res.push([i,j,k]);
      }
    }
  }
  return res;
}

function fmtPct(x){
  return (x*100).toFixed(2) + "%";
}

function run(){
  const hist = getFullHistory();
  if(hist.length===0){
    alert("æ­·å²è³‡æ–™ç‚ºç©ºï¼Œç„¡æ³•è¨ˆç®—ã€‚");
    return;
  }

  let r = parseFloat(document.getElementById("r").value);
  if(isNaN(r) || r<=0 || r>=1){
    r = 0.8;
    document.getElementById("r").value = "0.80";
  }
  const useStreak = document.getElementById("streak").checked;

  const probs = singleProbsByR(hist, r, useStreak);
  const trios = allTrios();
  trios.sort((A,B)=> trioProb(probs,B) - trioProb(probs,A));

  // æ›´æ–° Top1~Top10 é¡¯ç¤º
  const top10 = trios.slice(0,10);
  const ul = document.getElementById("toplist");
  if(!top10.length){
    ul.innerHTML = "<li>ï¼ˆæ²’æœ‰å¯ç”¨çµ„åˆï¼‰</li>";
  }else{
    let html = "";
    top10.forEach((T,idx)=>{
      const p = trioProb(probs, T);
      html += `<li>${idx+1}. ${T.join(" ")}  â†’  ${fmtPct(p)}</li>`;
      if(idx !== top10.length-1){
        html += `<div class="divider"></div>`;
      }
    });
    ul.innerHTML = html;
  }

  // æˆ‘çš„ä¸‹æ³¨çµæœ
  const betsTxt = document.getElementById("bets").value.trim();
  const myDiv = document.getElementById("myres");
  if(!betsTxt){
    myDiv.textContent = "å°šæœªè¼¸å…¥ä¸‹æ³¨ã€‚";
  }else{
    const lines = betsTxt.split(/\n+/).map(l=>l.trim()).filter(Boolean);
    const out = [];
    for(const line of lines){
      const trio = line.split(/\s+/).map(x=>parseInt(x,10)).filter(n=>!isNaN(n)).slice(0,3);
      if(trio.length!==3){
        out.push(`${line}  â†’  æ ¼å¼éŒ¯èª¤ï¼Œç•¥é`);
        continue;
      }
      // æ’åºé¡¯ç¤ºï¼Œé¿å…åŒçµ„å¯«æ³•ä¸åŒ
      trio.sort((a,b)=>a-b);
      const p = trioProb(probs, trio);
      let tag = "";
      if(p >= 0.03) tag = "â˜…ç›¸å°åé«˜";
      else if(p >= 0.02) tag = "è‰¯";
      out.push(`${trio.join(" ")}  â†’  ${fmtPct(p)} ${tag}`);
    }
    myDiv.textContent = out.join("\n");
  }
}

// åˆå§‹åŒ–çµ±è¨ˆ
updateStats();
</script>
</body>
</html>
